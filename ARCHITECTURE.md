# AIDebugPro - Architecture Overview

## ??? System Architecture

AIDebugPro follows a clean, layered architecture with **7 distinct layers** plus a **new AI Integration Layer** for context-aware debugging assistance.

### **High-Level Architecture Diagram**

```
???????????????????????????????????????????????????????????????????
?                   PRESENTATION LAYER (Windows Forms)            ?
?  MainForm ? WebView Panel ? AI Assistant ? Logs Dashboard      ?
???????????????????????????????????????????????????????????????????
                 ?                                    ?
    ??????????????????????????????????????????      ?
    ?                         ?              ?      ?
???????????????   ????????????????   ???????????????  ? NEW!
? Browser     ?   ? Data         ?   ? AI         ??
? Integration ?   ? Orchestration?   ? Debug      ?? ? Context-Aware
? (WebView2)  ?   ? (Telemetry)  ?   ? Assistant  ??   AI Analysis
???????????????   ????????????????   ???????????????
    ?                    ?                  ?       ?
    ?????????????????????????????????????????????????
                         ?
                  ????????????????
                  ? Persistence  ?
                  ?  (LiteDB)    ?
                  ????????????????
                         ?
                  ????????????????
                  ?   Services   ?
                  ? (DI, Logging)?
                  ????????????????
```

---

## ?? Layer Details

### **1. Presentation Layer** (`Presentation/`)

**Purpose:** User interface and view models

**Key Components:**
- `MainForm.cs` - Main window, coordinates all UI
- `WebViewPanel.cs` - Chromium browser with navigation
- `AIAssistantPanel.cs` - **? Context-aware AI chat interface** (ENHANCED)
- `LogsDashboard.cs` - Telemetry display with **AI quick actions** (ENHANCED)
- `CommandToolbar.cs` - Quick action buttons

**? NEW AI Features:**
- Right-click telemetry items ? "Ask AI"
- Context-aware chat responses
- Auto-analysis on capture stop
- Quick prompts for common queries

---

### **2. AI Debug Assistant Layer** (`AIIntegration/`) ? **ENHANCED**

**Purpose:** Context-aware AI debugging assistance

**Key Components:**

#### **? NEW: `AIDebugAssistant.cs`**
- **Core AI debugging service**
- Analyzes telemetry with GPT-4
- Provides root cause analysis
- Generates fix recommendations

```csharp
public class AIDebugAssistant
{
    Task<AIDebugResponse> AnalyzeAsync(string userQuery, TelemetryContext context)
    Task<AIDebugResponse> AnalyzeConsoleErrorAsync(ConsoleMessage error)
    Task<AIDebugResponse> AnalyzeNetworkFailureAsync(NetworkRequest request)
    Task<AIDebugResponse> AnalyzePerformanceAsync(PerformanceMetrics metrics)
    Task<SessionAnalysis> AnalyzeSessionAsync(Guid sessionId)
}
```

#### **? NEW: `TelemetryContextBuilder.cs`**
- **Gathers telemetry context for AI**
- Current tab state
- Selected items
- Recent errors/warnings
- Network failures
- Performance bottlenecks

```csharp
public class TelemetryContextBuilder
{
    Task<TelemetryContext> BuildContextAsync(
        Guid sessionId,
        ActiveTab currentTab,
        object? selectedItem = null)
}
```

#### **Existing (Enhanced):**
- `OpenAIClient.cs` - GPT-4 API integration
- `PromptComposer.cs` - **Enhanced with debug-specific prompts**
- `ResponseParser.cs` - Parse AI analysis results
- `TokenManager.cs` - Token counting and limits

---

## ?? Data Flow

### **? NEW: Context-Aware AI Analysis Flow**

```
User Action (e.g., Right-click error ? "Ask AI")
    ?
    ?
MainForm captures context
    ?
    ?? Active tab (Console/Network/Performance)
    ?? Selected telemetry item
    ?? Recent telemetry (last 30s)
    ?? Session statistics
    ?
    ?
TelemetryContextBuilder enriches context
    ?
    ?? Related console messages
    ?? Related network requests
    ?? Performance metrics
    ?? DOM snapshot (if available)
    ?
    ?
PromptComposer creates AI prompt
    ?
    ?? User query
    ?? Telemetry context
    ?? Debug-specific instructions
    ?? Expected output format
    ?
    ?
OpenAI GPT-4 analyzes
    ?
    ?? Root cause identification
    ?? Impact assessment
    ?? Fix recommendations
    ?? Related item links
    ?
    ?
ResponseParser extracts insights
    ?
    ?
AIAssistantPanel displays results
    ?
    ?? Chat message with analysis
    ?? Highlight related telemetry
    ?? Show code examples
    ?? Update Issues/Recommendations tabs
```

---

## ?? AI Chat Integration Architecture

### **Component Interaction:**

```
????????????????????????????????????????????????????????????
? LogsDashboard (Console/Network/Performance)              ?
?                                                           ?
?  [Console Error List]                                    ?
?   ?? Right-click ? "Ask AI about this error" ????       ?
?                                                   ?       ?
?  [Network Request List]                          ?       ?
?   ?? Right-click ? "Analyze this request" ????????       ?
?                                                   ?       ?
?  [Performance Metrics]                           ?       ?
?   ?? Click ? "Why is page slow?" ?????????????????       ?
????????????????????????????????????????????????????????????
                                                    ?
                                                    ?
?????????????????????????????????????????????????????????????
? MainForm (Coordinator)                                    ?
?                                                            ?
?  - Captures user action + selected item                   ?
?  - Calls TelemetryContextBuilder                         ?
?  - Forwards to AIDebugAssistant                          ?
?????????????????????????????????????????????????????????????
                         ?
                         ?
?????????????????????????????????????????????????????????????
? TelemetryContextBuilder                                   ?
?                                                            ?
?  BuildContextAsync()                                      ?
?   ?? Get recent telemetry (Console, Network, Performance)?
?   ?? Extract selected item details                       ?
?   ?? Calculate session statistics                        ?
?   ?? Build structured context object                     ?
?????????????????????????????????????????????????????????????
                         ?
                         ?
?????????????????????????????????????????????????????????????
? AIDebugAssistant                                          ?
?                                                            ?
?  AnalyzeAsync(userQuery, context)                        ?
?   ?? Compose debug prompt (PromptComposer)              ?
?   ?? Call OpenAI GPT-4 (OpenAIClient)                   ?
?   ?? Parse response (ResponseParser)                     ?
?   ?? Return AIDebugResponse                              ?
?????????????????????????????????????????????????????????????
                         ?
                         ?
?????????????????????????????????????????????????????????????
? AIAssistantPanel (Display Results)                       ?
?                                                            ?
?  - Add AI message to chat                                ?
?  - Highlight related telemetry items                     ?
?  - Show code examples                                    ?
?  - Update Issues/Recommendations tabs                    ?
?????????????????????????????????????????????????????????????
```

---

## ?? Data Models

### **? NEW: AI Chat Models**

```csharp
public class TelemetryContext
{
    Guid SessionId
    ActiveTab CurrentTab
    List<ConsoleMessage> RecentConsoleMessages
    List<NetworkRequest> RecentNetworkRequests
    PerformanceMetrics? LatestPerformanceMetrics
    ConsoleMessage? SelectedConsoleMessage
    NetworkRequest? SelectedNetworkRequest
    TelemetryStatistics SessionStatistics
    string CurrentUrl
    DateTime Timestamp
}

public class AIDebugResponse
{
    string Message // AI's response text
    List<Guid> RelatedTelemetryIds // Items to highlight
    List<CodeExample> CodeExamples
    IssueSeverity Severity
    List<string> RecommendedFixes
    Dictionary<string, string> Metadata
}

public enum ActiveTab
{
    Console,
    Network,
    Performance
}
```

---

## ?? Dependency Injection

```csharp
// Services/DependencyInjection/ServiceRegistration.cs

// AI Integration (? ENHANCED)
services.AddSingleton<IAIClient, OpenAIClient>();
services.AddSingleton<PromptComposer>();
services.AddSingleton<ResponseParser>();
services.AddSingleton<TokenManager>();

// ? NEW: AI Debug Assistant
services.AddSingleton<AIDebugAssistant>();
services.AddSingleton<TelemetryContextBuilder>();

// ... existing services ...
```

---

## ?? Telemetry Flow (Enhanced with AI)

```
Browser Event (console.error, network request, etc.)
    ?
    ?
CDP Listener (ConsoleListener, NetworkListener, etc.)
    ?
    ?
TelemetryAggregator (stores in memory)
    ?
    ?? Stored in session data ???????????????
    ?                                        ?
    ?                                        ?
LogsDashboard displays ??????????? TelemetryContextBuilder
    ?                                   (for AI analysis)
    ?                                        ?
    ? User action:                           ?
    ? Right-click error                 AIDebugAssistant
    ? "Ask AI" ???????????????????????????????
    ?                                        ?
    ?                                        ?
    ?                                   OpenAI GPT-4
    ?                                        ?
    ?                                        ?
    ????????????????????????? AIAssistantPanel
              Displays AI analysis
```

---

## ?? Security Considerations

**? NEW: AI Privacy & Security**

1. **PII Redaction before AI:**
   - Redact sensitive data (emails, tokens, passwords)
   - Anonymize user-specific identifiers
   - Use RedactionService before sending to OpenAI

2. **Token Limits:**
   - Limit telemetry context size
   - Prioritize recent/relevant data
   - Use TokenManager to stay within limits

3. **API Key Protection:**
   - User Secrets in development
   - Environment variables in production
   - Never log or expose API keys

4. **Rate Limiting:**
   - Prevent excessive AI API calls
   - Cache repeated queries
   - Implement user-facing rate limits

---

## ?? Key Design Patterns

1. **Dependency Injection** - All services registered in DI container
2. **Repository Pattern** - Data access abstraction
3. **Observer Pattern** - CDP event listeners
4. **Command Pattern** - User actions (Start/Stop capture, etc.)
5. **Strategy Pattern** - Different AI prompt strategies
6. **? NEW: Context Pattern** - TelemetryContext for AI analysis
7. **? NEW: Assistant Pattern** - AIDebugAssistant as intelligent helper

---

## ?? Scalability

**Current Limitations:**
- In-memory telemetry storage (per session)
- Single-user desktop application
- No cloud synchronization

**Future Enhancements:**
- Persistent database (LiteDB ? SQL Server)
- Multi-user/team features
- Cloud-based AI analysis
- Session sharing and collaboration

---

## ?? Technology Stack

**Core:**
- .NET 9.0
- C# 13
- Windows Forms

**Browser:**
- WebView2 (Chromium)
- Chrome DevTools Protocol (CDP)

**AI:**
- OpenAI GPT-4 API
- ? Context-aware prompting
- ? Telemetry enrichment

**Storage:**
- LiteDB (NoSQL embedded database)
- In-memory caching

**Logging:**
- Serilog (structured logging)
- File-based logs

---

**Updated:** December 2024  
**Version:** 1.1 (AI Chat Integration)
